<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MADvids — Experiments</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="dns-prefetch" href="https://storage.googleapis.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        @view-transition { navigation: auto; }
        ::view-transition-old(root) { animation: vt-fade 0.25s ease both; }
        ::view-transition-new(root) { animation: vt-fade 0.25s ease both reverse; }
        ::view-transition-old(hero) { animation: vt-shrink 0.35s cubic-bezier(0.16,1,0.3,1) both; }
        ::view-transition-new(hero) { animation: vt-grow 0.35s cubic-bezier(0.16,1,0.3,1) both; }
        @keyframes vt-fade { to { opacity: 0; } }
        @keyframes vt-shrink { to { transform: scale(0.94); opacity: 0; } }
        @keyframes vt-grow { from { transform: scale(0.94); opacity: 0; } }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: #f2f2f7;
            color: #1a1a2e;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
            -webkit-text-size-adjust: 100%;
        }

/* ═══════════════════════════════════════
           HERO
           ═══════════════════════════════════════ */
        .hero {
            position: relative;
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0 24px;
            z-index: 1;
            will-change: transform, opacity;
            background: #fff;
        }

        /* Video-textured title */
        .title-container {
            position: relative;
            isolation: isolate;
            overflow: hidden;
            padding: 20vh 25vw;
            margin: -20vh -25vw;
        }

        .title-video {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 0;
        }

        .title-mask {
            position: relative;
            z-index: 1;
            background: #fff;
            mix-blend-mode: screen;
            padding: 8px 0;
            box-shadow: 0 0 0 100vmax #fff;
        }

        .title-mask h1 {
            font-size: clamp(52px, 12vw, 160px);
            font-weight: 900;
            letter-spacing: -0.045em;
            line-height: 0.92;
            color: #000;
            text-align: center;
            text-transform: uppercase;
        }

        .title-mask .line {
            display: block;
        }

        .letter {
            display: inline-block;
            opacity: 0;
            transform: translateY(50px) scale(0.94);
            will-change: transform, opacity;
        }
        .letter.revealed {
            opacity: 1;
            transform: translateY(0) scale(1);
            transition: opacity 0.9s cubic-bezier(0.16, 1, 0.3, 1),
                        transform 0.9s cubic-bezier(0.16, 1, 0.3, 1);
        }

        /* Blend-mode fallback */
        @supports not (mix-blend-mode: screen) {
            .title-mask { background: transparent; mix-blend-mode: normal; }
            .title-mask h1 { color: #1a1a2e; }
            .title-video { display: none; }
        }

        .subtitle {
            font-size: clamp(14px, 1.6vw, 17px);
            font-weight: 400;
            color: rgba(26,26,46,0.35);
            text-align: center;
            max-width: 440px;
            line-height: 1.65;
            margin-top: clamp(28px, 4vw, 44px);
            opacity: 0;
            transform: translateY(20px);
        }
        .subtitle.revealed {
            opacity: 1;
            transform: translateY(0);
            transition: opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1),
                        transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .scroll-cue {
            position: absolute;
            bottom: clamp(28px, 5vw, 48px);
            left: 50%;
            transform: translateX(-50%);
            color: rgba(26,26,46,0.15);
            opacity: 0;
            transition: opacity 0.5s;
        }
        .scroll-cue.visible {
            opacity: 1;
        }
        .scroll-cue svg {
            animation: float 2.8s cubic-bezier(0.37, 0, 0.63, 1) infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(7px); }
        }
        @keyframes fadeIn {
            to { opacity: 1; }
        }

        /* ═══════════════════════════════════════
           EXPERIMENTS GRID
           ═══════════════════════════════════════ */
        .experiments {
            position: relative;
            z-index: 2;
            padding: clamp(20px, 4vw, 40px) max(24px, env(safe-area-inset-left, 24px)) clamp(80px, 12vw, 160px);
            max-width: 1300px;
            margin: 0 auto;
            content-visibility: auto;
            contain-intrinsic-size: auto 800px;
        }

        /* Decorative orbs — give glass cards something to blur */
        .orb {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
            z-index: 0;
        }
        .orb-1 {
            top: -80px;
            left: -60px;
            width: 480px;
            height: 480px;
            background: radial-gradient(circle, rgba(100,130,255,0.09) 0%, transparent 70%);
        }
        .orb-2 {
            bottom: 40px;
            right: -80px;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(255,120,170,0.07) 0%, transparent 70%);
        }
        .orb-3 {
            top: 45%;
            left: 30%;
            width: 350px;
            height: 350px;
            background: radial-gradient(circle, rgba(80,220,180,0.06) 0%, transparent 70%);
        }

        .grid {
            position: relative;
            z-index: 1;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(min(100%, 360px), 1fr));
            gap: clamp(16px, 2.5vw, 24px);
        }

        /* ═══════════════════════════════════════
           GLASS CARD
           ═══════════════════════════════════════ */
        .card {
            display: block;
            text-decoration: none;
            color: inherit;
            border-radius: 20px;
            padding: 8px;
            background: rgba(255,255,255,0.55);
            backdrop-filter: blur(40px) saturate(180%);
            -webkit-backdrop-filter: blur(40px) saturate(180%);
            border: 1px solid rgba(255,255,255,0.75);
            box-shadow:
                inset 0 1px 0 rgba(255,255,255,0.5),
                0 0 0 0.5px rgba(0,0,0,0.03),
                0 2px 8px rgba(0,0,0,0.03),
                0 12px 40px rgba(0,0,0,0.04);
            opacity: 0;
            transform: translateY(36px);
            will-change: transform, opacity;
            contain: layout style paint;
        }
        .card.visible {
            opacity: 1;
            transform: translateY(0);
            transition:
                opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1),
                transform 0.8s cubic-bezier(0.16, 1, 0.3, 1),
                box-shadow 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .card:hover {
            transform: translateY(-4px) scale(1.008);
            box-shadow:
                inset 0 1px 0 rgba(255,255,255,0.5),
                0 0 0 0.5px rgba(0,0,0,0.04),
                0 4px 16px rgba(0,0,0,0.05),
                0 24px 64px rgba(0,0,0,0.08);
        }
        .card.visible:hover {
            transform: translateY(-4px) scale(1.008);
            transition:
                transform 0.5s cubic-bezier(0.16, 1, 0.3, 1),
                box-shadow 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        /* Card preview — inset with its own radius */
        .card-preview {
            position: relative;
            width: 100%;
            aspect-ratio: 16 / 9;
            overflow: hidden;
            border-radius: 13px;
            background: rgba(26,26,46,0.04);
            transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            transform-origin: center center;
        }
        .card-preview::before {
            content: '';
            position: absolute; inset: 0; z-index: 1;
            background: linear-gradient(
                110deg,
                transparent 30%,
                rgba(255,255,255,0.15) 50%,
                transparent 70%
            );
            background-size: 200% 100%;
            animation: shimmer 2s ease infinite;
        }
        .card-preview.loaded::before { opacity: 0; transition: opacity 0.5s; }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .card-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .card-preview video.playing { opacity: 1; }

        .card-preview.no-video {
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(26,26,46,0.03), rgba(26,26,46,0.07));
        }
        .card-preview.no-video .placeholder {
            font-size: 2rem;
            font-weight: 900;
            letter-spacing: -0.04em;
            color: rgba(26,26,46,0.06);
        }

        /* Card body */
        .card-body {
            padding: clamp(14px, 2.5vw, 18px) clamp(14px, 2.5vw, 18px) clamp(16px, 2.5vw, 20px);
        }
        .card-body h2 {
            font-size: 0.95rem;
            font-weight: 650;
            color: #1a1a2e;
            letter-spacing: -0.015em;
            margin-bottom: 5px;
        }
        .card-body p {
            font-size: 0.78rem;
            color: rgba(26,26,46,0.4);
            line-height: 1.55;
        }
        .card-body .tags {
            display: flex;
            gap: 6px;
            margin-top: 12px;
        }
        .card-body .tag-pill {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.56rem;
            color: rgba(26,26,46,0.3);
            background: rgba(26,26,46,0.04);
            padding: 4px 10px;
            border-radius: 6px;
            letter-spacing: 0.02em;
        }

        /* ═══════════════════════════════════════
           RESPONSIVE
           ═══════════════════════════════════════ */
        @media (hover: none) {
            .card:hover,
            .card.visible:hover {
                transform: none;
                box-shadow:
                    inset 0 1px 0 rgba(255,255,255,0.5),
                    0 0 0 0.5px rgba(0,0,0,0.03),
                    0 2px 8px rgba(0,0,0,0.03),
                    0 12px 40px rgba(0,0,0,0.04);
            }
        }

        @media (max-width: 480px) {
            .hero { padding: 0 16px; }
            .experiments { padding-left: 16px; padding-right: 16px; }
            .title-mask h1 { font-size: clamp(40px, 13vw, 64px); }
        }

        @supports (padding-bottom: env(safe-area-inset-bottom)) {
            .experiments { padding-bottom: max(clamp(80px, 12vw, 160px), env(safe-area-inset-bottom)); }
        }

        @media (prefers-reduced-motion: reduce) {
            .letter { opacity: 1; transform: none; }
            .letter.revealed { transition: none; }
            .subtitle { opacity: 1; transform: none; }
            .subtitle.revealed { transition: none; }
            .card { opacity: 1; transform: none; }
            .card.visible { transition: none; }
            .card-preview::before { animation: none; }
            .scroll-cue svg { animation: none; }
            .hero { will-change: auto; }
            .splash { display: none; }
        }

        /* ═══════════════════════════════════════
           SPLASH / LOADING SCREEN
           ═══════════════════════════════════════ */
        body.loading { overflow: hidden; }

        .splash {
            position: fixed;
            inset: 0;
            z-index: 9999;
            background: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 32px;
            transition: opacity 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .splash.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .splash-title {
            font-size: clamp(32px, 8vw, 56px);
            font-weight: 900;
            letter-spacing: -0.045em;
            color: #1a1a2e;
            text-transform: uppercase;
            opacity: 0;
            transform: translateY(12px);
            animation: splashIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) 0.1s forwards;
        }

        .splash-bar-track {
            width: min(240px, 60vw);
            height: 3px;
            border-radius: 3px;
            background: rgba(26,26,46,0.06);
            overflow: hidden;
            opacity: 0;
            animation: splashIn 0.5s cubic-bezier(0.16, 1, 0.3, 1) 0.3s forwards;
        }
        .splash-bar {
            height: 100%;
            width: 0%;
            border-radius: 3px;
            background: rgba(26,26,46,0.25);
            transition: width 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes splashIn {
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="loading">
    <div class="splash" id="splash">
        <div class="splash-title"><span style="font-weight:900">MAD</span><span style="font-weight:300">vids</span></div>
        <div class="splash-bar-track">
            <div class="splash-bar" id="splashBar"></div>
        </div>
    </div>

    <section class="hero" id="hero">
        <div class="title-container">
            <video class="title-video" muted autoplay loop playsinline disablePictureInPicture preload="auto">
                <source src="https://storage.googleapis.com/myproject-public-assets/ddn/videos/test/Video_Generation_With_Specific_Colors%20copy.mp4" type="video/mp4">
            </video>
            <div class="title-mask">
                <h1 id="heroTitle">
                    <span class="line">Video</span>
                    <span class="line">Experiences</span>
                </h1>
            </div>
        </div>
        <p class="subtitle" id="heroSubtitle">
            Where cinematic video meets precision web engineering — scroll animation, parallax, interactive layouts. 60fps. Always.
        </p>
        <div class="scroll-cue" id="scrollCue">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M6 9l6 6 6-6"/>
            </svg>
        </div>
    </section>

    <section class="experiments">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>

        <div class="grid">
            <a class="card" href="experiments/superflat/index.html">
                <div class="card-preview">
                    <video muted loop playsinline disablePictureInPicture preload="auto">
                        <source src="https://storage.googleapis.com/myproject-public-assets/art/MADvids/Surreal_Murakami_Dreamscape_Video_Generation.mp4" type="video/mp4">
                    </video>
                </div>
                <div class="card-body">
                    <h2>Superflat</h2>
                    <p>Scroll-driven journey through a Murakami dreamscape with playful pop-art typography.</p>
                    <div class="tags">
                        <span class="tag-pill">murakami</span>
                        <span class="tag-pill">scroll</span>
                        <span class="tag-pill">AI-video</span>
                    </div>
                </div>
            </a>

            <a class="card" href="experiments/hyperpod-cinematic/index.html">
                <div class="card-preview">
                    <video muted loop playsinline disablePictureInPicture preload="auto">
                        <source src="https://storage.googleapis.com/myproject-public-assets/ddn/videos/test/hyperpod-dgfdf.mp4" type="video/mp4">
                    </video>
                </div>
                <div class="card-body">
                    <h2>Cinematic Scroll</h2>
                    <p>Sticky full-screen video with scroll-driven section reveals and animated stat counters.</p>
                    <div class="tags">
                        <span class="tag-pill">scroll-driven</span>
                        <span class="tag-pill">video</span>
                    </div>
                </div>
            </a>

            <a class="card" href="experiments/hyperpod-showcase/index.html">
                <div class="card-preview">
                    <video muted loop playsinline disablePictureInPicture preload="auto">
                        <source src="https://storage.googleapis.com/myproject-public-assets/ddn/videos/test/hyperpod-jhojeh.mp4" type="video/mp4">
                    </video>
                </div>
                <div class="card-body">
                    <h2>Split Narrative</h2>
                    <p>Alternating content sections over dedicated video backgrounds with metric pills.</p>
                    <div class="tags">
                        <span class="tag-pill">parallax</span>
                        <span class="tag-pill">marketing</span>
                    </div>
                </div>
            </a>

            <a class="card" href="experiments/hyperpod-grid/index.html">
                <div class="card-preview">
                    <video muted loop playsinline disablePictureInPicture preload="auto">
                        <source src="https://storage.googleapis.com/myproject-public-assets/ddn/videos/test/hyperpod-kjhxsa.mp4" type="video/mp4">
                    </video>
                </div>
                <div class="card-body">
                    <h2>Bento Mosaic</h2>
                    <p>Asymmetric video grid with staggered cell reveals, marquee ticker, and label overlays.</p>
                    <div class="tags">
                        <span class="tag-pill">grid</span>
                        <span class="tag-pill">bento</span>
                    </div>
                </div>
            </a>

            <a class="card" href="experiments/hyperpod-immersive/index.html">
                <div class="card-preview">
                    <video muted loop playsinline disablePictureInPicture preload="none">
                        <source src="https://storage.googleapis.com/myproject-public-assets/ddn/videos/test/hyperpod-jfdgyie.mp4" type="video/mp4">
                    </video>
                </div>
                <div class="card-body">
                    <h2>Depth & Grain</h2>
                    <p>Parallax video zoom with film grain, numbered feature strips, and frosted metric cards.</p>
                    <div class="tags">
                        <span class="tag-pill">parallax</span>
                        <span class="tag-pill">cinematic</span>
                    </div>
                </div>
            </a>

            <a class="card" href="experiments/delightfull-video/index.html">
                <div class="card-preview">
                    <video muted loop playsinline disablePictureInPicture preload="none">
                        <source src="https://storage.googleapis.com/myproject-public-assets/ddn/videos/test/Video_Generation_With_Specific_Colors%20copy.mp4" type="video/mp4">
                    </video>
                </div>
                <div class="card-body">
                    <h2>Delightful Video</h2>
                    <p>Scroll-driven typography animation with video background and staggered letter reveals.</p>
                    <div class="tags">
                        <span class="tag-pill">typography</span>
                        <span class="tag-pill">scroll</span>
                    </div>
                </div>
            </a>

            <a class="card" href="experiments/chromatic-shift/index.html">
                <div class="card-preview">
                    <video muted loop playsinline disablePictureInPicture preload="none">
                        <source src="https://storage.googleapis.com/myproject-public-assets/ddn/videos/test/hyperpod-kjhxsa.mp4" type="video/mp4">
                    </video>
                </div>
                <div class="card-body">
                    <h2>Chromatic Shift</h2>
                    <p>Scroll-driven color grading with live blend-mode overlays transforming one video through five cinematic moods.</p>
                    <div class="tags">
                        <span class="tag-pill">color</span>
                        <span class="tag-pill">blend-mode</span>
                    </div>
                </div>
            </a>

            <a class="card" href="experiments/mesh-flow/index.html">
                <div class="card-preview">
                    <video muted loop playsinline disablePictureInPicture preload="none">
                        <source src="https://storage.googleapis.com/myproject-public-assets/ddn/videos/test/hyperpod-jhojeh.mp4" type="video/mp4">
                    </video>
                </div>
                <div class="card-body">
                    <h2>Mesh Flow</h2>
                    <p>Floating gradient blobs with screen blending, scroll-driven parallax, and ambient sine-wave drift over video.</p>
                    <div class="tags">
                        <span class="tag-pill">gradients</span>
                        <span class="tag-pill">blend-mode</span>
                    </div>
                </div>
            </a>

            <a class="card" href="experiments/lumina/index.html">
                <div class="card-preview">
                    <video muted loop playsinline disablePictureInPicture preload="none">
                        <source src="https://storage.googleapis.com/myproject-public-assets/ddn/videos/test/claude-pretty-ugvuda.mp4" type="video/mp4">
                    </video>
                </div>
                <div class="card-body">
                    <h2>Lumina</h2>
                    <p>Interactive light story — collect luminous particles to unlock a poetic narrative. Gamified with combos and achievements.</p>
                    <div class="tags">
                        <span class="tag-pill">interactive</span>
                        <span class="tag-pill">canvas</span>
                        <span class="tag-pill">game</span>
                    </div>
                </div>
            </a>

            <a class="card" href="experiments/shape-reveal/index.html">
                <div class="card-preview">
                    <video muted loop playsinline disablePictureInPicture preload="none">
                        <source src="https://storage.googleapis.com/myproject-public-assets/ddn/videos/test/hyperpod-dgfdf.mp4" type="video/mp4">
                    </video>
                </div>
                <div class="card-body">
                    <h2>Shape Reveal</h2>
                    <p>Scroll-driven clip-path morphing — seven geometric shapes progressively unmask the video.</p>
                    <div class="tags">
                        <span class="tag-pill">clip-path</span>
                        <span class="tag-pill">scroll</span>
                        <span class="tag-pill">geometry</span>
                    </div>
                </div>
            </a>

            <a class="card" href="experiments/autonomy-dashboard/index.html">
                <div class="card-preview no-video">
                    <span class="placeholder">Dashboard</span>
                </div>
                <div class="card-body">
                    <h2>Autonomy Dashboard</h2>
                    <p>React-based interactive dashboard with real-time data visualizations and cyber-themed UI.</p>
                    <div class="tags">
                        <span class="tag-pill">react</span>
                        <span class="tag-pill">vite</span>
                    </div>
                </div>
            </a>
        </div>
    </section>

    <script>
        /* ═══ 0. SPLASH / LOADING SCREEN ═══
           Waits for fonts + hero video + first card videos.
           Max timeout 6s so it never hangs forever. */

        var splash = document.getElementById('splash');
        var splashBar = document.getElementById('splashBar');
        var splashDismissed = false;

        /* Track loading milestones */
        var loadState = { fonts: false, heroVideo: false, cardVideos: 0 };
        var cardVideos = document.querySelectorAll('.card-preview video');
        var targetCards = Math.min(cardVideos.length, 3); /* first row (3 cards) */

        function updateProgress() {
            var total = 2 + targetCards; /* fonts + hero + N cards */
            var done = (loadState.fonts ? 1 : 0)
                     + (loadState.heroVideo ? 1 : 0)
                     + Math.min(loadState.cardVideos, targetCards);
            var pct = Math.round((done / total) * 100);
            splashBar.style.width = pct + '%';
            if (done >= total) dismissSplash();
        }

        function dismissSplash() {
            if (splashDismissed) return;
            splashDismissed = true;
            splashBar.style.width = '100%';
            setTimeout(function() {
                splash.classList.add('hidden');
                document.body.classList.remove('loading');
                startHeroAnimation();
                initFarObserver();
                splash.addEventListener('transitionend', function() {
                    splash.remove();
                }, { once: true });
            }, 200);
        }

        /* Fonts */
        if (document.fonts && document.fonts.ready) {
            document.fonts.ready.then(function() {
                loadState.fonts = true;
                updateProgress();
            });
        } else {
            loadState.fonts = true;
        }

        /* Hero video */
        var heroVid = document.querySelector('.title-video');
        if (heroVid) {
            if (heroVid.readyState >= 3) {
                loadState.heroVideo = true;
            } else {
                heroVid.addEventListener('canplaythrough', function() {
                    loadState.heroVideo = true;
                    updateProgress();
                }, { once: true });
            }
        } else {
            loadState.heroVideo = true;
        }

        /* Card videos — listen for enough data on first N */
        cardVideos.forEach(function(v, i) {
            if (i >= targetCards) return;
            if (v.readyState >= 2) {
                loadState.cardVideos++;
            } else {
                v.addEventListener('loadeddata', function() {
                    loadState.cardVideos++;
                    updateProgress();
                }, { once: true });
            }
        });

        /* Initial check (some may already be loaded) */
        updateProgress();

        /* Max timeout — never wait more than 6s */
        setTimeout(dismissSplash, 6000);

        /* ═══ 1. LETTER-BY-LETTER REVEAL ═══
           Split title lines into individual <span> letters.
           Each letter transitions in with a staggered delay.
           Uses class-toggle transitions (not CSS animation) so
           will-change can be cleaned up after reveal completes.
           Triggered AFTER splash dismisses. */

        var lines = document.querySelectorAll('#heroTitle .line');
        var allLetters = [];

        lines.forEach(function(line, lineIdx) {
            var text = line.textContent;
            line.textContent = '';
            var lineDelay = lineIdx * 120;
            for (var i = 0; i < text.length; i++) {
                var span = document.createElement('span');
                span.className = 'letter';
                span.textContent = text[i] === ' ' ? '\u00A0' : text[i];
                span.dataset.delay = String(lineDelay + i * 28 + 200);
                line.appendChild(span);
                allLetters.push(span);
            }
        });

        function startHeroAnimation() {
            allLetters.forEach(function(span) {
                var delay = parseInt(span.dataset.delay);
                setTimeout(function() {
                    span.classList.add('revealed');
                }, delay);
            });

            var subtitleDelay = 200 + (allLetters.length * 28) + 120 + 200;
            setTimeout(function() {
                document.getElementById('heroSubtitle').classList.add('revealed');
            }, subtitleDelay);

            setTimeout(function() {
                document.getElementById('scrollCue').classList.add('visible');
            }, subtitleDelay + 600);

            /* Clean up will-change after all animations settle */
            setTimeout(function() {
                allLetters.forEach(function(s) { s.style.willChange = 'auto'; });
            }, subtitleDelay + 1200);
        }

        /* ═══ 2. HERO PARALLAX ON SCROLL ═══
           Compositor-only: transform + opacity via translate3d.
           Throttled to one rAF per frame for guaranteed 60fps. */

        var hero = document.getElementById('hero');
        var scrollCue = document.getElementById('scrollCue');
        var heroTicking = false;
        var cachedVH = window.innerHeight;

        window.addEventListener('resize', function() {
            cachedVH = window.innerHeight;
        }, { passive: true });

        window.addEventListener('scroll', function() {
            if (!heroTicking) {
                requestAnimationFrame(function() {
                    var y = window.scrollY;
                    var p = Math.min(y / (cachedVH * 0.7), 1);
                    hero.style.transform = 'translate3d(0,' + (y * 0.35) + 'px,0)';
                    hero.style.opacity = String(1 - p);
                    if (y > 60 && scrollCue.classList.contains('visible')) {
                        scrollCue.classList.remove('visible');
                    }
                    heroTicking = false;
                });
                heroTicking = true;
            }
        }, { passive: true });

        /* ═══ 3. CARD STAGGER REVEAL ═══
           IntersectionObserver triggers class-based transitions.
           Stagger delay by card index for a cascade effect. */

        var cardObserver = new IntersectionObserver(function(entries) {
            entries.forEach(function(e) {
                if (e.isIntersecting) {
                    var idx = parseInt(e.target.dataset.idx || '0');
                    setTimeout(function() {
                        e.target.classList.add('visible');
                    }, idx * 90);
                    cardObserver.unobserve(e.target);
                }
            });
        }, { threshold: 0.08 });

        document.querySelectorAll('.card').forEach(function(c, i) {
            c.dataset.idx = String(i);
            cardObserver.observe(c);
        });

        /* ═══ 4. LAZY VIDEO PLAYBACK ═══
           Only decode videos in/near the viewport.
           Play on intersect, pause when out. */

        var videosInView = new Set();

        var videoObserver = new IntersectionObserver(function(entries) {
            entries.forEach(function(e) {
                var v = e.target;
                if (e.isIntersecting) {
                    videosInView.add(v);
                    tryPlay(v);
                } else {
                    videosInView.delete(v);
                    v.pause();
                    v.classList.remove('playing');
                }
            });
        }, { rootMargin: '120px' });

        function tryPlay(v) {
            v.play().then(function() {
                v.classList.add('playing');
                v.closest('.card-preview').classList.add('loaded');
            }).catch(function() {});
        }

        /* Smooth loop: fade out near end, fade back in at start */
        function initLoopFade(v) {
            var fadeZone = 0.4; /* seconds before end to start fading */
            v.addEventListener('timeupdate', function() {
                if (!v.duration) return;
                var remaining = v.duration - v.currentTime;
                if (remaining < fadeZone) {
                    v.style.opacity = String(remaining / fadeZone);
                } else if (v.currentTime < fadeZone) {
                    v.style.opacity = String(Math.min(v.currentTime / fadeZone, 1));
                } else if (v.style.opacity !== '1' && v.style.opacity !== '') {
                    v.style.opacity = '1';
                }
            });
        }

        document.querySelectorAll('.card-preview video').forEach(function(v) {
            v.addEventListener('loadeddata', function() {
                v.closest('.card-preview').classList.add('loaded');
                if (videosInView.has(v)) tryPlay(v);
            }, { once: true });
            initLoopFade(v);
            videoObserver.observe(v);
        });

        /* ═══ 5. PREFETCH ON HOVER ═══
           Warm the browser cache for instant navigation. */

        var prefetched = {};
        document.querySelectorAll('.card').forEach(function(card) {
            card.addEventListener('mouseenter', function() {
                var href = card.getAttribute('href');
                if (!href || prefetched[href]) return;
                prefetched[href] = true;
                var link = document.createElement('link');
                link.rel = 'prefetch';
                link.href = href;
                document.head.appendChild(link);
            }, { once: true });
        });

        /* ═══ 6. VIDEO MEMORY MANAGEMENT ═══
           Far-observer releases video decoders when cards are
           well outside the viewport, restores src when approaching.
           Deferred until after splash so preload="auto" isn't killed. */

        function initFarObserver() {
            var farObserver = new IntersectionObserver(function(entries) {
                entries.forEach(function(e) {
                    var v = e.target.querySelector('video');
                    if (!v) return;
                    if (!e.isIntersecting) {
                        v.pause();
                        v.removeAttribute('src');
                        v.load();
                        v.classList.remove('playing');
                    } else if (!v.getAttribute('src')) {
                        var source = v.querySelector('source');
                        if (source) {
                            v.src = source.getAttribute('src');
                        }
                    }
                });
            }, { rootMargin: '600px' });

            document.querySelectorAll('.card-preview').forEach(function(cp) {
                farObserver.observe(cp);
            });
        }

        /* ═══ 7. CARD TILT + VIDEO SPEED ON HOVER ═══ */
        if (window.matchMedia('(hover: hover)').matches) {
            document.querySelectorAll('.card').forEach(function(card) {
                var preview = card.querySelector('.card-preview');
                var vid = card.querySelector('.card-preview video');

                card.addEventListener('mousemove', function(e) {
                    var rect = card.getBoundingClientRect();
                    var x = (e.clientX - rect.left) / rect.width;
                    var y = (e.clientY - rect.top) / rect.height;
                    var rx = (0.5 - y) * 10;
                    var ry = (x - 0.5) * 10;
                    if (preview) {
                        preview.style.transition = 'transform 0.1s ease-out';
                        preview.style.transform = 'perspective(800px) rotateX(' + rx + 'deg) rotateY(' + ry + 'deg) scale(1.02)';
                    }
                });

                card.addEventListener('mouseleave', function() {
                    if (preview) {
                        preview.style.transition = 'transform 0.5s cubic-bezier(0.16, 1, 0.3, 1)';
                        preview.style.transform = '';
                    }
                    if (vid) vid.playbackRate = 1;
                });

                card.addEventListener('mouseenter', function() {
                    if (vid) vid.playbackRate = 0.6;
                });
            });
        }

        /* ═══ 8. VIEW TRANSITION — set name on clicked card ═══ */
        document.querySelectorAll('.card').forEach(function(card) {
            card.addEventListener('click', function() {
                var preview = card.querySelector('.card-preview');
                if (preview) preview.style.viewTransitionName = 'hero';
            });
        });

        /* ═══ 9. SERVICE WORKER ═══ */
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/MADvids/sw.js').catch(function() {});
        }
    </script>
</body>
</html>
